<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinalShowdown - Q3 & Q4 Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .option-label { transition: all 0.2s; }
        .option-input:checked + .option-label { border-color: #2563EB; background-color: #EFF6FF; }
        .dark .option-input:checked + .option-label { border-color: #3b82f6; background-color: #1e3a5f; }
        .correct-answer { border-color: #10B981 !important; background-color: #D1FAE5 !important; }
        .dark .correct-answer { border-color: #10B981 !important; background-color: #064e3b !important; color: #a7f3d0 !important; }
        .incorrect-answer { border-color: #EF4444 !important; background-color: #FEE2E2 !important; }
        .dark .incorrect-answer { border-color: #EF4444 !important; background-color: #7f1d1d !important; color: #fecaca !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .theme-toggle { transition: transform 0.3s ease; }
        .theme-toggle:hover { transform: rotate(15deg); }
        .toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); z-index: 9999; transition: top 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .toast.show { top: 20px; }
        .toast-content { display: flex; align-items: center; gap: 10px; padding: 12px 24px; border-radius: 50px; font-weight: 600; font-size: 14px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); backdrop-filter: blur(10px); }
        .toast-on { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .toast-off { background: linear-gradient(135deg, #64748b 0%, #475569 100%); color: white; }
        .identification-input { transition: all 0.2s; }
        .identification-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 min-h-screen flex flex-col transition-colors duration-300">

    <div id="toast" class="toast">
        <div id="toast-content" class="toast-content toast-on">
            <span id="toast-icon" class="toast-icon"><i class="fa-solid fa-bolt"></i></span>
            <span id="toast-message">Auto Check is on</span>
        </div>
    </div>

    <header class="bg-white dark:bg-slate-800 shadow-sm sticky top-0 z-20 transition-colors">
        <div class="max-w-4xl mx-auto px-3 sm:px-4 py-3 flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-3">
            <h1 class="text-lg sm:text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                <i class="fa-solid fa-bolt text-amber-500"></i>
                <span>FinalShowdown</span>
                <span class="text-slate-400 dark:text-slate-500 font-normal text-xs sm:text-sm ml-1 hidden md:inline">Q3 & Q4 Combined</span>
            </h1>
            <div class="flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-end">
                <select id="module-filter" onchange="filterQuestions()" class="bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 text-xs sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-1.5 sm:p-2 flex-1 sm:flex-none max-w-[180px] sm:max-w-none">
                    <option value="all">All Questions (50)</option>
                    <option value="q3">Quiz 3 - Test 1 (25)</option>
                    <option value="q4">Quiz 4 - Test 2 (25)</option>
                </select>
                <div class="text-xs sm:text-sm font-medium text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 sm:px-3 py-1 rounded-full whitespace-nowrap">
                    <span id="current-q-num">1</span> / <span id="total-q-num">--</span>
                </div>
                <button onclick="toggleDarkMode()" class="theme-toggle p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" title="Toggle Dark Mode">
                    <i class="fa-solid fa-moon text-slate-600 dark:hidden"></i>
                    <i class="fa-solid fa-sun text-yellow-400 hidden dark:inline"></i>
                </button>
                <button id="auto-reveal-btn" onclick="toggleAutoReveal()" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" title="Auto Reveal (off)">
                    <i class="fa-solid fa-bolt text-slate-400 dark:text-slate-500"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow p-2 sm:p-4">
        <div class="max-w-3xl mx-auto">
            <div id="question-nav" class="mb-4 sm:mb-6">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 flex-grow">
                        <div id="progress-bar" class="bg-blue-600 dark:bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div id="question-dots" class="flex flex-wrap gap-1.5 justify-center"></div>
            </div>
            <div id="quiz-container" class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 sm:p-6 md:p-8 relative overflow-hidden min-h-[350px] sm:min-h-[400px] transition-colors"></div>
            <div id="quiz-controls" class="mt-4 sm:mt-6 flex flex-col sm:flex-row justify-between gap-3 sm:gap-4 sticky bottom-2 sm:bottom-4 z-10">
                <button id="prev-btn" onclick="prevQuestion()" class="hidden sm:flex shadow-md px-4 sm:px-6 py-2.5 sm:py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-200 font-medium hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed items-center justify-center gap-2 text-sm sm:text-base">
                    <i class="fa-solid fa-arrow-left"></i> <span>Previous</span>
                </button>
                <div class="flex gap-2 sm:gap-3 w-full sm:w-auto order-first sm:order-none">
                    <button id="shuffle-btn" onclick="shuffleQuestions()" class="shadow-md flex-1 sm:flex-none px-3 sm:px-6 py-2.5 sm:py-3 bg-fuchsia-50 dark:bg-fuchsia-900/30 border border-fuchsia-200 dark:border-fuchsia-700 text-fuchsia-700 dark:text-fuchsia-400 rounded-lg font-medium hover:bg-fuchsia-100 dark:hover:bg-fuchsia-900/50 transition-colors flex items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fa-solid fa-shuffle"></i> Shuffle
                    </button>
                    <button id="reset-btn" onclick="resetCurrentQuestion()" class="shadow-md flex-1 sm:flex-none px-3 sm:px-6 py-2.5 sm:py-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 text-yellow-700 dark:text-yellow-400 rounded-lg font-medium hover:bg-yellow-100 dark:hover:bg-yellow-900/50 transition-colors flex items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fa-solid fa-rotate-right"></i> Reset
                    </button>
                    <button id="retake-btn-nav" onclick="retakeQuiz()" class="hidden shadow-md flex-1 sm:flex-none px-3 sm:px-6 py-2.5 sm:py-3 bg-slate-200 dark:bg-slate-600 border border-slate-300 dark:border-slate-500 text-slate-700 dark:text-slate-200 rounded-lg font-medium hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fa-solid fa-arrows-rotate"></i> Retake
                    </button>
                    <button id="reveal-btn" onclick="revealAnswer()" class="shadow-md flex-1 sm:flex-none px-3 sm:px-6 py-2.5 sm:py-3 bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-700 text-indigo-700 dark:text-indigo-400 rounded-lg font-medium hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-colors flex items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fa-solid fa-eye"></i> Reveal
                    </button>
                </div>
                <button id="next-btn-desktop" onclick="nextQuestion()" class="hidden sm:flex shadow-md px-4 sm:px-6 py-2.5 sm:py-3 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed items-center justify-center gap-2 text-sm sm:text-base">
                    Next <i class="fa-solid fa-arrow-right"></i>
                </button>
                <div class="flex sm:hidden gap-2 w-full order-last">
                    <button id="prev-btn-mobile" onclick="prevQuestion()" class="shadow-md flex-1 px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-200 font-medium hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm">
                        <i class="fa-solid fa-arrow-left"></i> Prev
                    </button>
                    <button id="next-btn-mobile" onclick="nextQuestion()" class="shadow-md flex-1 px-4 py-2.5 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm">
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-50 dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 mt-auto py-4 sm:py-6 transition-colors">
        <div class="max-w-3xl mx-auto px-4 text-center text-slate-500 dark:text-slate-400 text-xs sm:text-sm">
            <p>FinalShowdown: Quiz 3 & Quiz 4 Combined (50 Questions)</p>
        </div>
    </footer>

    <div id="confirm-modal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center transition-opacity opacity-0">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4 border border-slate-200 dark:border-slate-700 transform scale-95 transition-transform duration-200" id="modal-content">
            <div class="text-center">
                <div class="w-14 h-14 rounded-full bg-fuchsia-100 dark:bg-fuchsia-900/30 text-fuchsia-600 dark:text-fuchsia-400 mx-auto flex items-center justify-center mb-4 ring-4 ring-fuchsia-50 dark:ring-fuchsia-900/20">
                    <i class="fa-solid fa-dice text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Shuffle Questions?</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-6 leading-relaxed">This will randomize the order of all questions and answer choices.</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="closeConfirmModal()" class="flex-1 px-4 py-2.5 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-medium hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">Cancel</button>
                    <button onclick="confirmShuffle()" class="flex-1 px-4 py-2.5 bg-fuchsia-600 text-white rounded-xl font-medium hover:bg-fuchsia-700 shadow-lg shadow-fuchsia-600/20 transition-all hover:scale-[1.02]">Yes, Shuffle</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data from q3q4.json
        const quiz3Data = [
            {id:301,module:"q3",question:"Which of the following is true about multiplexing?",options:["a. Multiplexing is a form of modulation done at the transmitter side to convert analog signals to digital signals.","b. Space division multiplexing allows multiple input sources to be carried via the same medium but not at the same time.","c. In FDM, signals from multiple sources are interleaved by bits, bytes, or frames.","d. Statistical TDM allows prioritization of channels by assigning different numbers of time slots for each input."],correctIndex:3},
            {id:302,module:"q3",question:"Which of the following is true about CDM?",options:["a. Each user is assigned a pseudo-random code, which should be orthogonal to all the other codes.","b. The receiver has prior knowledge of the orthogonal code.","c. The orthogonal code spreads the signal such that the resulting signal will have higher bandwidth.","d. All of the choices"],correctIndex:3},
            {id:303,module:"q3",question:"Packet Switching is a method that transmits digital information which are cut into smaller pieces of information that may take different routes.",type:"identification",correctAnswer:"Packet switching"},
            {id:304,module:"q3",question:"________ Approach is a packet switching approach wherein each packet takes different routes and is routed depending on the identifiers in the packet.",type:"identification",correctAnswer:"Datagram"},
            {id:305,module:"q3",question:"In circuit switching, ________ is a method wherein paths are separated spatially and requires interconnection in a grid to complete the end-to-end physical link.",options:["a. Crossbar switch","b. TSI incorrect","c. TDM bus","d. None of the choices"],correctIndex:0},
            {id:306,module:"q3",question:"In circuit switching, ________ is a method wherein a path between an output and input is managed by a control unit depending on the allotted time slot.",options:["a. Crossbar switch","b. TSI incorrect","c. TDM bus","d. None of the choices"],correctIndex:2},
            {id:307,module:"q3",question:"Which of the following is part of the X.25 packet header?",options:["a. Error detecting code","b. Data","c. Logical channel number","d. All of the choices"],correctIndex:3},
            {id:308,module:"q3",question:"Which of the following is part of the X.25 packet header?",options:["a. Address field","b. Packet identifier","c. Logical channel number","d. All of the choices"],correctIndex:1},
            {id:309,module:"q3",question:"Which of the following is an example of a copper-guided transmission medium?",options:["a. Waveguide","b Coaxial cable","c. Fiber optic cable","d. All of the choices"],correctIndex:1},
            {id:310,module:"q3",question:"Which of the following is used to transmit electrical signals?",options:["a Coaxial cable","b. Fiber optic cable","c. Waveguide","d. All of the choices"],correctIndex:0},
            {id:311,module:"q3",question:"Which of the following is used to transmit radio waves?",options:["a. Coaxial cable","b. Fiber optic cable","c. Waveguide","d. None of the choices"],correctIndex:2},
            {id:312,module:"q3",question:"Which of the cables was used for 10Base2 Ethernet?",options:["a. RG59","b. RG58","c. RG11","d. RJ45"],correctIndex:1},
            {id:313,module:"q3",question:"Which of the cables was used for 10Base5 Ethernet?",options:["a. RG59","b. RG58","c. RG11","d. RJ45"],correctIndex:2},
            {id:314,module:"q3",question:"________ is a type of fiber optic cable that has a uniform core refractive index and where light waves often travel in a single path.",options:["a. Multimode step index","b. Single-mode step index","c. Multimode graded index","d. Single multimode graded index"],correctIndex:1},
            {id:315,module:"q3",question:"In fiber optic cables, the density of the core is highest at the center and lowest at the edge (near the cladding).",options:["a. Multimode step index","b. Single-mode step index","c. Multimode graded index","d. Single multimode graded index"],correctIndex:2},
            {id:316,module:"q3",question:"________ is commonly used for AM broadcasting.",options:["a. Surface wave propagation","b. Sky wave propagation","c. Space wave propagation","d. Satellite propagation"],correctIndex:0},
            {id:317,module:"q3",question:"________ uses highly directional antennas so that the signal travels in a straight line from one point to another in the Earth's surface.",options:["a. Surface wave propagation","b. Sky wave propagation","c. Space wave propagation","d. Satellite propagation"],correctIndex:2},
            {id:318,module:"q3",question:"________ is also known as ionospheric propagation.",options:["a. Surface wave propagation","b. Sky wave propagation","c. Space wave propagation","d. Satellite propagation"],correctIndex:1},
            {id:319,module:"q3",question:"How many voice channels does T1 line carry?",options:["a. 24","b. 48","c. 96","d. 192"],correctIndex:0},
            {id:320,module:"q3",question:"How many voice channels does T2 line carry?",options:["a. 24","b. 48","c. 96","d. 192"],correctIndex:2},
            {id:321,module:"q3",question:"How many voice channels does T3 line carry?",options:["a. 96","b. 192","c. 384","d 672"],correctIndex:3},
            {id:322,module:"q3",question:"How many voice channels does T5 line carry?",options:["a. 1024","b. 2048","c. 4032","d 8064"],correctIndex:3},
            {id:323,module:"q3",question:"How many T1 lines can a T3 line carry?",options:["a. 12","b. 24","c. 28","d. 48"],correctIndex:2},
            {id:324,module:"q3",question:"What is the line speed of T1 line in Mbps?",options:["a. 1.544 Mbps","b. 2.048 Mbps","c. 3.152 Mbps","d. 6.312 Mbps"],correctIndex:0},
            {id:325,module:"q3",question:"What is the line speed of E3 line in Mbps?",options:["a. 0.064 Mbps","b. 2.048 Mbps","c. 8.448 Mbps","d 34.368 Mbps"],correctIndex:3}
        ];

        const quiz4Data = [
            {id:401,module:"q4",question:"A nonprofit US trade association that establishes and recommends industrial standards.",options:["a. IEEE","b. EIA","c. TIA","d. ISO"],correctIndex:1},
            {id:402,module:"q4",question:"A standards organization responsible for the 802.xx series standards.",options:["a. IEEE","b. EIA","c. TIA","d. ISO"],correctIndex:0},
            {id:403,module:"q4",question:"ANSI is the official standards agency of the US (acronym).",type:"identification",correctAnswer:"American National Standards Institute"},
            {id:404,module:"q4",question:"ETSI is the European Standards Organization dealing with telecommunications, broadcasting, and other communication services (acronym).",type:"identification",correctAnswer:"European Telecommunications Standards Institute"},
            {id:405,module:"q4",question:"IETF is a technical advisory group of the Internet Society that oversees the architecture and procedures used in the Internet.",options:["TRUE","FALSE"],correctIndex:1},
            {id:406,module:"q4",question:"RFC are documents maintained by IETF containing information about Internet Protocols (acronym).",type:"identification",correctAnswer:"Request for Comments"},
            {id:407,module:"q4",question:"An organization that promotes long-term research of importance to the evolution of the future Internet.",options:["a. IETF","b. IRTF (Internet Research Task Force)","c. IAB","d. IEEE"],correctIndex:1},
            {id:408,module:"q4",question:"It is a non-treaty organization whose membership is comprised mainly of standards organizations of various countries and is responsible for Open Systems Interconnect (OSI) model.",options:["a. IEEE","b. IETF","c. ITU","d. ISO"],correctIndex:3},
            {id:409,module:"q4",question:"It is the United Nations specialized agency for information and communication technologies (ICTs).",options:["a. IEEE","b. IETF","c. ITU","d. ISO"],correctIndex:2},
            {id:410,module:"q4",question:"An ITU series of standards that cover the global information infrastructure, Internet protocol aspects, next generation networks, Internet of Things, and smart cities.",options:["a. W","b. X","c. Y","d. Z"],correctIndex:2},
            {id:411,module:"q4",question:"IEEE 802.15.1 is the equivalent standard for Bluetooth.",options:["TRUE","FALSE"],correctIndex:0},
            {id:412,module:"q4",question:"Which of the following is a PAN?",options:["a. Wi-Fi","b Zigbee","c. 1G","d. 2G"],correctIndex:1},
            {id:413,module:"q4",question:"A class 3 bluetooth can reach a distance of 100 meters.",options:["TRUE","FALSE"],correctIndex:1},
            {id:414,module:"q4",question:"Bluetooth Low Energy is also known as Wibro.",options:["TRUE","FALSE"],correctIndex:1},
            {id:415,module:"q4",question:"The standard for Zigbee is",options:["a. IEEE 802.3","b. IEEE 805.11","c. IEEE 802.15.2","d. IEEE 805.15.4"],correctIndex:3},
            {id:416,module:"q4",question:"Advanced Mobile Telephone Systems (AMTS) was used in the 1st generation of Mobile Network Technologies",options:["TRUE","FALSE"],correctIndex:1},
            {id:417,module:"q4",question:"The main drawback of the 1G Mobile Network Technologies is interoperability with different countries.",options:["TRUE","FALSE"],correctIndex:0},
            {id:418,module:"q4",question:"A Mobile Network technology that uses TDMA to multiplex up to 8 calls per channel in the 900 and 1800 MHz bands.",options:["a. AMTS","b. TACS","c. CDMA","d. GSM"],correctIndex:3},
            {id:419,module:"q4",question:"It enables cellular network operators to provide Internet access, instant messaging, and multimedia messaging using second-generation Mobile Networks.",options:["a. TACS","b. AMTS","c. GPRS","d. FHSS"],correctIndex:2},
            {id:420,module:"q4",question:"HSDPA is a 3G packet-based data service in WCDMA downlink with data transmission up to 8-10 Mbit/s over a 5 MHz bandwidth in WCDMA downlink.",options:["TRUE","FALSE"],correctIndex:0},
            {id:421,module:"q4",question:"4G uses network wide based IP-based packet switching.",options:["TRUE","FALSE"],correctIndex:0},
            {id:422,module:"q4",question:"________ is a type of malware that takes control over a device without user knowledge.",options:["a. Virus","b. Trojan horse","c. Worm","d. Man-in-the-middle"],correctIndex:1},
            {id:423,module:"q4",question:"________ is a technique to improve a malicious website's ranking through increasing traffic to the malicious website.",options:["a. Phishing","b. Vulnerability exploitation","c. DDoS","d. SEO poisoning"],correctIndex:3},
            {id:424,module:"q4",question:"Which of the following is a good practice to protect devices and networks?",options:["a. Use antivirus and antispyware","b. Keep firewall on","c. Update OS","d. All of the choices"],correctIndex:3},
            {id:425,module:"q4",question:"________ is a type of firewall that hides private addresses of hosts in a local area network.",options:["a. Host-based firewall","b. Proxy server","c. NAT firewall","d. Network layer firewall"],correctIndex:2}
        ];

        const allQuizData = [...quiz3Data, ...quiz4Data];
        let filteredQuizData = [...allQuizData];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let revealState = {};
        let identificationAnswers = {};
        let autoRevealEnabled = localStorage.getItem('autoReveal') === 'true';

        const container = document.getElementById('quiz-container');
        const progressBar = document.getElementById('progress-bar');
        const currentQNum = document.getElementById('current-q-num');
        const totalQNum = document.getElementById('total-q-num');

        // Normalize answer for identification comparison
        function normalizeAnswer(str) {
            return str.trim().toLowerCase().replace(/\s+/g, ' ');
        }

        // Check if identification answer is correct (flexible validation)
        function isIdentificationCorrect(userInput, correctAnswer) {
            if (!userInput) return false;
            const normalized = normalizeAnswer(userInput);
            const correctNormalized = normalizeAnswer(correctAnswer);
            // Exact match (case insensitive)
            if (normalized === correctNormalized) return true;
            // Check if first letter capitalized version matches
            const userCapitalized = userInput.trim().charAt(0).toUpperCase() + userInput.trim().slice(1).toLowerCase();
            if (normalizeAnswer(userCapitalized) === correctNormalized) return true;
            return false;
        }

        function toggleAutoReveal() {
            autoRevealEnabled = !autoRevealEnabled;
            localStorage.setItem('autoReveal', autoRevealEnabled);
            updateAutoRevealButton();
            showAutoRevealToast();
        }

        function showAutoRevealToast() {
            const toast = document.getElementById('toast');
            const content = document.getElementById('toast-content');
            const message = document.getElementById('toast-message');
            if (autoRevealEnabled) {
                content.classList.remove('toast-off');
                content.classList.add('toast-on');
                message.textContent = 'Auto Check is on';
            } else {
                content.classList.remove('toast-on');
                content.classList.add('toast-off');
                message.textContent = 'Auto Check is off';
            }
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function updateAutoRevealButton() {
            const btn = document.getElementById('auto-reveal-btn');
            if (!btn) return;
            const icon = btn.querySelector('i');
            if (autoRevealEnabled) {
                icon.classList.remove('text-slate-400', 'dark:text-slate-500');
                icon.classList.add('text-amber-500', 'dark:text-amber-400');
                btn.title = 'Auto Reveal (on)';
                btn.classList.add('ring-2', 'ring-amber-400');
            } else {
                icon.classList.remove('text-amber-500', 'dark:text-amber-400');
                icon.classList.add('text-slate-400', 'dark:text-slate-500');
                btn.title = 'Auto Reveal (off)';
                btn.classList.remove('ring-2', 'ring-amber-400');
            }
        }

        function tryAutoReveal() {
            if (!autoRevealEnabled) return;
            const data = filteredQuizData[currentQuestionIndex];
            const qID = data.id;
            if (revealState[qID]) return;
            if (data.type === 'identification') {
                if (identificationAnswers[qID] && identificationAnswers[qID].trim()) {
                    revealState[qID] = true;
                    renderQuestion(false);
                }
            } else if (userAnswers[qID] !== undefined && userAnswers[qID] !== null) {
                revealState[qID] = true;
                renderQuestion(false);
            }
        }

        function filterQuestions() {
            const filterValue = document.getElementById('module-filter').value;
            if (filterValue === 'all') filteredQuizData = [...allQuizData];
            else if (filterValue === 'q3') filteredQuizData = [...quiz3Data];
            else if (filterValue === 'q4') filteredQuizData = [...quiz4Data];
            userAnswers = {};
            revealState = {};
            identificationAnswers = {};
            currentQuestionIndex = 0;
            initQuiz();
        }

        function initQuiz() {
            document.getElementById('question-nav').style.display = 'block';
            document.getElementById('quiz-controls').style.display = 'flex';
            updateAutoRevealButton();
            totalQNum.textContent = filteredQuizData.length;
            renderQuestionNav();
            renderQuestion();
        }

        function renderQuestion(animate = true) {
            if (filteredQuizData.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-500 py-10">No questions found.</div>`;
                return;
            }
            const data = filteredQuizData[currentQuestionIndex];
            const qID = data.id;
            currentQNum.textContent = currentQuestionIndex + 1;
            progressBar.style.width = `${((currentQuestionIndex + 1) / filteredQuizData.length) * 100}%`;

            let contentHtml = '';
            if (data.type === 'identification') {
                contentHtml = renderIdentificationQuestion(data, qID);
            } else {
                contentHtml = renderSingleChoiceQuestion(data, qID);
            }

            const isReviewMode = Object.values(revealState).filter(v => v === true).length === filteredQuizData.length;
            const quizLabel = data.module === 'q3' ? 'Quiz 3' : 'Quiz 4';
            const reviewBadge = isReviewMode ? '<span class="bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 text-xs font-bold px-2.5 py-0.5 rounded border border-indigo-200 dark:border-indigo-700"><i class="fa-solid fa-magnifying-glass mr-1"></i>Review Mode</span>' : '';

            container.innerHTML = `
                <div class="${animate ? 'fade-in' : ''}">
                    <div class="mb-3 flex flex-wrap items-center gap-2">
                        <span class="bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300 text-xs font-bold px-2.5 py-0.5 rounded border border-blue-200 dark:border-blue-700">${quizLabel}</span>
                        ${data.type === 'identification' ? '<span class="bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300 text-xs font-bold px-2.5 py-0.5 rounded border border-purple-200 dark:border-purple-700"><i class="fa-solid fa-keyboard mr-1"></i>Identification</span>' : ''}
                        ${reviewBadge}
                    </div>
                    <h2 class="text-lg sm:text-xl md:text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4 sm:mb-6 leading-snug">${data.question}</h2>
                    ${contentHtml}
                </div>
            `;
            updateButtons();
            updateQuestionNav();
        }

        function renderIdentificationQuestion(data, qID) {
            const isRevealed = revealState[qID];
            const userInput = identificationAnswers[qID] || '';
            const isCorrect = isRevealed && isIdentificationCorrect(userInput, data.correctAnswer);
            const isIncorrect = isRevealed && userInput && !isCorrect;
            const isUnanswered = isRevealed && !userInput;

            let inputClass = "identification-input w-full p-4 border-2 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 text-base font-medium outline-none";
            if (isCorrect) inputClass += " border-green-500 bg-green-50 dark:bg-green-900/30";
            else if (isIncorrect) inputClass += " border-red-500 bg-red-50 dark:bg-red-900/30";
            else if (isUnanswered) inputClass += " border-amber-400 bg-amber-50 dark:bg-amber-900/30";
            else inputClass += " border-slate-300 dark:border-slate-600";

            let html = `
                <div class="space-y-4">
                    <div class="relative">
                        <input type="text" id="identification-input" class="${inputClass}" 
                            placeholder="Type your answer here..." 
                            value="${userInput.replace(/"/g, '&quot;')}" 
                            ${isRevealed ? 'disabled' : ''}
                            onkeyup="handleIdentificationInput(event)"
                            oninput="saveIdentificationAnswer()">
                        ${isCorrect ? '<i class="fa-solid fa-circle-check text-green-600 absolute right-4 top-1/2 -translate-y-1/2 text-xl"></i>' : ''}
                        ${isIncorrect ? '<i class="fa-solid fa-circle-xmark text-red-500 absolute right-4 top-1/2 -translate-y-1/2 text-xl"></i>' : ''}
                        ${isUnanswered ? '<i class="fa-solid fa-triangle-exclamation text-amber-500 absolute right-4 top-1/2 -translate-y-1/2 text-xl"></i>' : ''}
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400"><i class="fa-solid fa-info-circle mr-1"></i>Case insensitive. First letter capitalization is accepted.</p>
                </div>
            `;

            if (isRevealed) {
                html += `
                    <div class="mt-6 p-4 ${isCorrect ? 'bg-green-50 dark:bg-green-900/30 border-l-4 border-green-500' : 'bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500'} text-slate-700 dark:text-slate-300 rounded-r-lg fade-in">
                        <h3 class="font-bold ${isCorrect ? 'text-green-800 dark:text-green-400' : 'text-blue-800 dark:text-blue-400'} mb-1">
                            <i class="fa-solid ${isCorrect ? 'fa-check-circle' : 'fa-circle-info'} mr-2"></i>${isCorrect ? 'Correct!' : 'Correct Answer'}
                        </h3>
                        <p class="font-medium text-lg">${data.correctAnswer}</p>
                    </div>
                `;
            }
            return html;
        }

        function renderSingleChoiceQuestion(data, qID) {
            let optionsHtml = '';
            data.options.forEach((opt, index) => {
                const isSelected = userAnswers[qID] === index;
                const isRevealed = revealState[qID];
                let labelClass = "option-label w-full p-3 sm:p-4 border-2 border-slate-200 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-3";
                let icon = '<div class="w-5 h-5 rounded-full border-2 border-slate-300 dark:border-slate-500 flex-shrink-0"></div>';

                if (isSelected && !isRevealed) {
                    labelClass += " border-blue-500 bg-blue-50 dark:bg-transparent dark:border-blue-400 dark:shadow-[0_0_15px_rgba(96,165,250,0.4)]";
                    icon = '<div class="w-5 h-5 rounded-full border-2 border-blue-500 flex items-center justify-center"><div class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div></div>';
                }

                if (isRevealed) {
                    const hasAnswered = userAnswers[qID] !== undefined && userAnswers[qID] !== null;
                    if (index === data.correctIndex) {
                        if (hasAnswered) {
                            labelClass = "option-label w-full p-4 border-2 rounded-lg flex items-center gap-3 correct-answer cursor-default";
                            icon = '<i class="fa-solid fa-circle-check text-green-600 text-lg"></i>';
                        } else {
                            labelClass = "option-label w-full p-4 border-2 border-amber-400 dark:border-amber-500 bg-amber-50 dark:bg-amber-900/30 rounded-lg flex items-center gap-3 cursor-default";
                            icon = '<i class="fa-solid fa-triangle-exclamation text-amber-500 text-lg"></i>';
                        }
                    } else if (isSelected && index !== data.correctIndex) {
                        labelClass = "option-label w-full p-4 border-2 rounded-lg flex items-center gap-3 incorrect-answer cursor-default";
                        icon = '<i class="fa-solid fa-circle-xmark text-red-500 text-lg"></i>';
                    } else {
                        labelClass += " opacity-60 cursor-default";
                    }
                }

                optionsHtml += `
                    <label class="${labelClass}">
                        <input type="radio" name="q${qID}" value="${index}" class="option-input hidden" ${isSelected ? 'checked' : ''} ${isRevealed ? 'disabled' : ''} onchange="selectOption(${index})">
                        ${icon}
                        <span class="text-slate-700 dark:text-slate-200 font-medium text-sm sm:text-base">${opt}</span>
                    </label>
                `;
            });
            return `<div class="space-y-3">${optionsHtml}</div>`;
        }

        function selectOption(index) {
            const qID = filteredQuizData[currentQuestionIndex].id;
            if (revealState[qID]) return;
            userAnswers[qID] = index;
            renderQuestion(false);
            tryAutoReveal();
        }

        function saveIdentificationAnswer() {
            const qID = filteredQuizData[currentQuestionIndex].id;
            if (revealState[qID]) return;
            const input = document.getElementById('identification-input');
            if (input) identificationAnswers[qID] = input.value;
        }

        function handleIdentificationInput(event) {
            saveIdentificationAnswer();
            if (event.key === 'Enter') tryAutoReveal();
        }

        function revealAnswer() {
            const data = filteredQuizData[currentQuestionIndex];
            const qID = data.id;
            if (data.type === 'identification') {
                const input = document.getElementById('identification-input');
                if (input) identificationAnswers[qID] = input.value;
            }
            revealState[qID] = true;
            renderQuestion(false);
        }

        function resetCurrentQuestion() {
            const qID = filteredQuizData[currentQuestionIndex].id;
            userAnswers[qID] = null;
            identificationAnswers[qID] = '';
            revealState[qID] = false;
            renderQuestion(false);
        }

        function shuffleQuestions() {
            const modal = document.getElementById('confirm-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); content.classList.remove('scale-95'); content.classList.add('scale-100'); }, 10);
        }

        function closeConfirmModal() {
            const modal = document.getElementById('confirm-modal');
            const content = document.getElementById('modal-content');
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function confirmShuffle() {
            for (let i = filteredQuizData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [filteredQuizData[i], filteredQuizData[j]] = [filteredQuizData[j], filteredQuizData[i]];
            }
            filteredQuizData.forEach(q => {
                if (q.type === 'identification' || !q.options || q.options.length < 2) return;
                let indices = q.options.map((_, i) => i);
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                const newOptions = indices.map(i => q.options[i]);
                const newCorrectIndex = indices.indexOf(q.correctIndex);
                if (userAnswers[q.id] !== undefined && userAnswers[q.id] !== null) {
                    userAnswers[q.id] = indices.indexOf(userAnswers[q.id]);
                }
                q.options = newOptions;
                q.correctIndex = newCorrectIndex;
            });
            currentQuestionIndex = 0;
            renderQuestionNav();
            renderQuestion();
            closeConfirmModal();
        }

        function nextQuestion() {
            if (currentQuestionIndex < filteredQuizData.length - 1) { currentQuestionIndex++; renderQuestion(); }
            else submitQuiz();
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); }
        }

        function renderQuestionNav() {
            const dotsContainer = document.getElementById('question-dots');
            let html = '';
            filteredQuizData.forEach((q, idx) => {
                html += `<button onclick="goToQuestion(${idx})" class="question-dot w-7 h-7 sm:w-8 sm:h-8 rounded-full text-xs font-bold transition-all ${idx === currentQuestionIndex ? 'ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-slate-900' : ''} bg-slate-200 dark:bg-slate-600 text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-500" data-idx="${idx}" title="Question ${idx + 1}">${idx + 1}</button>`;
            });
            dotsContainer.innerHTML = html;
        }

        function updateQuestionNav() {
            const dots = document.querySelectorAll('.question-dot');
            dots.forEach((dot, idx) => {
                const q = filteredQuizData[idx];
                const qID = q.id;
                const isCurrent = idx === currentQuestionIndex;
                dot.className = 'question-dot w-7 h-7 sm:w-8 sm:h-8 rounded-full text-xs font-bold transition-all';
                if (isCurrent) dot.classList.add('ring-2', 'ring-offset-2', 'ring-blue-500', 'dark:ring-offset-slate-900');
                if (revealState[qID]) {
                    const status = getQuestionStatus(q, qID);
                    if (status === 'correct') dot.classList.add('bg-green-500', 'dark:bg-green-600', 'text-white');
                    else if (status === 'incorrect') dot.classList.add('bg-red-500', 'dark:bg-red-600', 'text-white');
                    else dot.classList.add('bg-amber-400', 'dark:bg-amber-500', 'text-white');
                } else {
                    const hasAnswer = hasUserAnswered(q, qID);
                    if (hasAnswer) dot.classList.add('bg-blue-500', 'dark:bg-blue-600', 'text-white');
                    else dot.classList.add('bg-slate-200', 'dark:bg-slate-600', 'text-slate-600', 'dark:text-slate-300');
                }
            });
        }

        function getQuestionStatus(q, qID) {
            if (q.type === 'identification') {
                const userInput = identificationAnswers[qID];
                if (!userInput) return 'unanswered';
                return isIdentificationCorrect(userInput, q.correctAnswer) ? 'correct' : 'incorrect';
            } else {
                const selected = userAnswers[qID];
                if (selected === undefined || selected === null) return 'unanswered';
                return selected === q.correctIndex ? 'correct' : 'incorrect';
            }
        }

        function hasUserAnswered(q, qID) {
            if (q.type === 'identification') return identificationAnswers[qID] && identificationAnswers[qID].trim();
            return userAnswers[qID] !== undefined && userAnswers[qID] !== null;
        }

        function goToQuestion(idx) {
            if (idx >= 0 && idx < filteredQuizData.length) { currentQuestionIndex = idx; renderQuestion(); }
        }

        function updateButtons() {
            const qID = filteredQuizData[currentQuestionIndex].id;
            const prevBtn = document.getElementById('prev-btn');
            const prevBtnMobile = document.getElementById('prev-btn-mobile');
            const nextBtnDesktop = document.getElementById('next-btn-desktop');
            const nextBtnMobile = document.getElementById('next-btn-mobile');
            const revealBtn = document.getElementById('reveal-btn');
            const resetBtn = document.getElementById('reset-btn');
            const shuffleBtn = document.getElementById('shuffle-btn');
            const retakeBtnNav = document.getElementById('retake-btn-nav');

            if (prevBtn) prevBtn.disabled = currentQuestionIndex === 0;
            if (prevBtnMobile) prevBtnMobile.disabled = currentQuestionIndex === 0;

            const isLast = currentQuestionIndex === filteredQuizData.length - 1;
            [nextBtnDesktop, nextBtnMobile].forEach(btn => {
                if (!btn) return;
                if (isLast) {
                    btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Submit';
                    btn.classList.remove('bg-blue-600', 'dark:bg-blue-500');
                    btn.classList.add('bg-green-600', 'dark:bg-green-500');
                } else {
                    btn.innerHTML = 'Next <i class="fa-solid fa-arrow-right"></i>';
                    btn.classList.remove('bg-green-600', 'dark:bg-green-500');
                    btn.classList.add('bg-blue-600', 'dark:bg-blue-500');
                }
            });

            const isReviewMode = filteredQuizData.length > 0 && filteredQuizData.every(q => revealState[q.id]);
            if (isReviewMode) {
                revealBtn.style.display = 'none';
                resetBtn.style.display = 'none';
                if (shuffleBtn) shuffleBtn.style.display = 'none';
                if (retakeBtnNav) { retakeBtnNav.style.display = 'flex'; retakeBtnNav.classList.add('flex-1'); }
            } else {
                if (retakeBtnNav) retakeBtnNav.style.display = 'none';
                if (revealState[qID]) {
                    revealBtn.style.display = 'none';
                    if (shuffleBtn) shuffleBtn.style.display = 'none';
                    resetBtn.style.display = 'flex';
                } else {
                    revealBtn.style.display = 'flex';
                    if (shuffleBtn) shuffleBtn.style.display = 'flex';
                    resetBtn.style.display = 'flex';
                }
            }
        }

        function submitQuiz() {
            let correct = 0, answered = 0, total = filteredQuizData.length;
            filteredQuizData.forEach(q => {
                const qID = q.id;
                if (q.type === 'identification') {
                    const userInput = identificationAnswers[qID];
                    if (userInput && userInput.trim()) answered++;
                    if (isIdentificationCorrect(userInput, q.correctAnswer)) correct++;
                } else {
                    const selected = userAnswers[qID];
                    if (selected !== undefined && selected !== null) answered++;
                    if (selected === q.correctIndex) correct++;
                }
            });
            const percentage = Math.round((correct / total) * 100);
            const grade = percentage >= 90 ? 'A' : percentage >= 80 ? 'B' : percentage >= 70 ? 'C' : percentage >= 60 ? 'D' : 'F';
            const gradeColor = percentage >= 80 ? 'text-green-600 dark:text-green-400' : percentage >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400';

            container.innerHTML = `
                <div class="fade-in text-center py-6">
                    <div class="mb-6">
                        <i class="fa-solid fa-trophy text-6xl ${gradeColor} mb-4"></i>
                        <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100 mb-2">Quiz Complete!</h2>
                        <p class="text-slate-500 dark:text-slate-400">FinalShowdown - Q3 & Q4</p>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-700/50 rounded-2xl p-6 mb-6 inline-block">
                        <div class="text-6xl sm:text-7xl font-bold ${gradeColor} mb-2">${percentage}%</div>
                        <div class="text-2xl font-bold ${gradeColor} mb-4">Grade: ${grade}</div>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div><div class="text-2xl font-bold text-green-600 dark:text-green-400">${correct}</div><div class="text-xs text-slate-500">Correct</div></div>
                            <div><div class="text-2xl font-bold text-red-600 dark:text-red-400">${total - correct}</div><div class="text-xs text-slate-500">Incorrect</div></div>
                            <div><div class="text-2xl font-bold text-slate-600 dark:text-slate-300">${total}</div><div class="text-xs text-slate-500">Total</div></div>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3 justify-center">
                        <button onclick="reviewAnswers()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"><i class="fa-solid fa-magnifying-glass mr-2"></i>Review Answers</button>
                        <button onclick="retakeQuiz()" class="px-6 py-3 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg font-medium hover:bg-slate-300"><i class="fa-solid fa-rotate-right mr-2"></i>Retake Quiz</button>
                    </div>
                </div>
            `;
            document.getElementById('quiz-controls').style.display = 'none';
            document.getElementById('question-nav').style.display = 'none';
        }

        function reviewAnswers() {
            filteredQuizData.forEach(q => revealState[q.id] = true);
            currentQuestionIndex = 0;
            document.getElementById('quiz-controls').style.display = 'flex';
            document.getElementById('question-nav').style.display = 'block';
            renderQuestion();
        }

        function retakeQuiz() {
            filteredQuizData.forEach(q => { userAnswers[q.id] = null; identificationAnswers[q.id] = ''; revealState[q.id] = false; });
            currentQuestionIndex = 0;
            document.getElementById('quiz-controls').style.display = 'flex';
            document.getElementById('question-nav').style.display = 'block';
            renderQuestion();
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
        }

        function initDarkMode() {
            const stored = localStorage.getItem('darkMode');
            if (stored !== null) { if (stored === 'true') document.documentElement.classList.add('dark'); }
            else if (window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark');
        }

        initDarkMode();
        initQuiz();
    </script>
</body>
</html>